// main overwrite to make it all work
@function get-color-from-palette($palette, $hue: default, $opacity: null) {

  @if type-of($hue) == number and $hue >= 0 and $hue <= 1 {   
    @return get-color-from-palette($palette, default, $hue);
  }

  $color: map-get($palette, $hue);

  @if type-of($color) == color {
    $alpha: if($opacity == null, alpha($color), if($opacity != 1, $opacity, alpha($color)));
    @return rgba(red($color), green($color), blue($color), $alpha);
  }

  // at this point we have a variable
  // strip out color functions so we can return proper rgba value
  $color: _mat-css-strip-variable($color);

  // contrast color variables are defined as rgba
  @if (str-index($color, '-contrast-')) {
    @return rgba($color);
  }

  // non contrast variables are defined as rgb, so add alpha
  @return rgba($color, if($opacity == null, 1, $opacity));
}

// apply additional overwrites
@mixin mat-css-other-overwrites {
  .mat-button-focus-overlay {
    background: rgba(var(--palette-foreground-base), 1);
  }
  .mat-checkbox .mat-ripple-element {
    background-color: rgb(var(--palette-foreground-base));
  }
  @include _mat-checkbox-overwrites();
  @include _mat-slide-toggle-color-overwrites();
}

// Fix a problem where the contrast color for
// checkboxes are not rendered correctly.
@mixin _mat-checkbox-overwrites {
  // focus background color when tabbing
  .mat-checkbox .mat-ripple-element {
    background-color: rgb(var(--palette-foreground-base));
  }

  // -- Primary Color
  .mat-checkbox.mat-primary,
  .mat-checkbox.mat-primary {
    .mat-checkbox-checkmark .mat-checkbox-checkmark-path {
      stroke: mat-css-contrast-color-primary(500) !important;
    }
    .mat-checkbox-mixedmark {
      background-color: mat-css-contrast-color-primary(500) !important;
    }
  }
  // -- Accent Color
  .mat-checkbox.mat-accent,
  .mat-checkbox.mat-accent {
    .mat-checkbox-checkmark .mat-checkbox-checkmark-path {
      stroke: mat-css-contrast-color-accent(500) !important;
    }
    .mat-checkbox-mixedmark {
      background-color: mat-css-contrast-color-accent(500) !important;
    }
  }
  // -- Warning Color
  .mat-checkbox.mat-warn,
  .mat-checkbox.mat-warn {
    .mat-checkbox-checkmark .mat-checkbox-checkmark-path {
      stroke: mat-css-contrast-color-warn(500) !important;
    }
    .mat-checkbox-mixedmark {
      background-color: mat-css-contrast-color-warn(500) !important;
    }
  }
}

// Since we cannot override angulars namespace,
// target the style and overwrite it with the proper attributes.
@mixin _mat-slide-toggle-color-overwrites() {
  $thumb-checked-hue: 500;
  $accent: $mat-css-palette-accent;
  $primary: $mat-css-palette-primary;
  $warn: $mat-css-palette-warn;
  .mat-slide-toggle {
    @include _mat-slide-toggle-checked-color-theme($accent, $thumb-checked-hue);

    &.mat-primary {
      @include _mat-slide-toggle-checked-color-theme($primary, $thumb-checked-hue);
    }

    &.mat-warn {
      @include _mat-slide-toggle-checked-color-theme($warn, $thumb-checked-hue);
    }
  }
}
@mixin _mat-slide-toggle-checked-color-theme($palette, $thumb-checked-hue) {
  @include mat-css-dark-theme-global() {
    @include _mat-slide-toggle-checked-color($palette, $thumb-checked-hue)
  }
  @include mat-css-light-theme-global() {
    @include _mat-slide-toggle-checked-color($palette, $thumb-checked-hue)
  }
}
@mixin _mat-slide-toggle-checked-color($palette, $thumb-checked-hue) {
  &.mat-checked {
    .mat-slide-toggle-thumb {
      background-color: get-color-from-palette($palette, $thumb-checked-hue);
    }
    .mat-slide-toggle-bar {
      background-color: get-color-from-palette($palette, $thumb-checked-hue, 0.54);
    }
    .mat-ripple-element {
      background-color: get-color-from-palette($palette, $thumb-checked-hue);
    }
  }
}